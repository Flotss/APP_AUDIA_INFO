{% extends '/base.html.twig' %}

{% block title %}
	Page de connexion/Inscription
{% endblock %}

{% block stylesheet %}
	<link
      rel="stylesheet"
      href="/template/Connexion_Inscription/Inscription/connexions.css"
    />
{% endblock %}

{% block body %}
  <div class="container">
    <img class="logo" src="/assets/logo_eventIT.png" alt="Logo" />
    <form onAction="/connexion" method="POST">
      <input type="hidden" name="actionLogin" value="login" />
      <input type="text" class="form-control" placeholder="Nom d'utilisateur" name="username" />
      <input type="password" class="form-control" placeholder="Mot de passe" name="password" />
      <div id="signup-fields">
        <input
          type="password"
          class="form-control"
          placeholder="Confirmer le mot de passe"
          name="confirm_password"
        />
        <div class="form-group">
          <input type="password" class="form-control" placeholder="Confirmer le mot de passe" name="confirm_password">
          <i class="fa-solid fa-xmark bad" id="icon_same_password" style=""></i>
        </div>
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Email" name="email">
          <i class="fa fa-xmark bad" id="email-valid-icon" style=""></i>
        </div>
        <input type="text" class="form-control" placeholder="Nom" name="last_name" />
        <input type="text" class="form-control" placeholder="Prenom" name="first_name" />

        {# mot de passe checklist #}
        <div class="password-checklist" style="display:none">
          <div class="password-checklist-item">
            <i id="password-length" class="fa-solid fa-xmark bad"></i>
            <span class="password-checklist-item-text">8 caractères minimum</span>
          </div>
          <div class="password-checklist-item">
            <i id="password-uppercase" class="fa-solid fa-xmark bad"></i>
            <span class="password-checklist-item-text">1 majuscule</span>
          </div>
          <div class="password-checklist-item">
            <i id="password-lowercase" class="fa-solid fa-xmark bad"></i>
            <span class="password-checklist-item-text">1 minuscule</span>
          </div>
          <div class="password-checklist-item">
            <i id="password-number" class="fa-solid fa-xmark bad"></i>
            <span class="password-checklist-item-text">1 chiffre</span>
          </div>
          <div class="password-checklist-item">
            <i id="password-special" class="fa-solid fa-xmark bad"></i>
            <span class="password-checklist-item-text">1 caractère spécial</span>
          </div>
        </div>
      </div>
      <button class="btn" id="login" type="submit">Se connecter</button>
      <button class="btn" id="signup" type="button">S'inscrire</button>
      <button class="btn" id="returnToLogin" type="button" style="display: none">Retourner à la connexion</button>
    </form>
  </div>
{% endblock %}

{% block javascript %}
	<script>
      const btnReturn = document.getElementById('returnToLogin');
      const btnLogin = document.getElementById('login');
      const btnSignup = document.getElementById('signup');

      const inputAction = document.querySelector('input[name="actionLogin"]');
      document.getElementById('signup').addEventListener('click', function () {
        document.getElementById('signup-fields').style.maxHeight = '300px';
        btnReturn.style.display = 'block';
        btnLogin.style.display = 'none';
        setTimeout(() => {
          btnSignup.type = 'submit';
          inputAction.value = 'signup';
        }, 200);
      });

      document.getElementById('returnToLogin').addEventListener('click', function () {
        document.getElementById('signup-fields').style.maxHeight = '0';
        btnReturn.style.display = 'none';
        btnLogin.style.display = 'block';
        btnSignup.type = 'button';
        inputAction.value = 'login';
      });
  </script>
  <script>
    let allIsGood = false;
    const email = document.querySelector('input[name="email"]');
    const emailValidIcon = document.getElementById('email-valid-icon');

    email.addEventListener('input', function () {
      const value = email.value;
      const valid = value.match(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/);
      emailValidIcon.className = valid ? 'fa-solid fa-check good' : 'fa-solid fa-xmark bad';
    });


    const password = document.querySelector('input[name="password"]');
    const passwordChecklist = document.querySelector('.password-checklist');
    const passwordChecklistItems = document.querySelectorAll('.password-checklist-item');
    const passwordChecklistItemsIcon = document.querySelectorAll('.password-checklist-item i');

    {# if password is selected  #}
    password.addEventListener('focus', function () {
      passwordChecklist.style.display = 'block';
    });

    {# if password is not selected  #}
    password.addEventListener('blur', function () {
      passwordChecklist.style.display = 'none';
    });


    function checkPasswordCondition(condition, index) {
      passwordChecklistItemsIcon[index].className = condition ? 'fa-solid fa-check good' : 'fa-solid fa-xmark bad';
    }

    password.addEventListener('input', function () {
      const value = password.value;
    
      checkPasswordCondition(value.length >= 8, 0);
      checkPasswordCondition(value.match(/[A-Z]/), 1);
      checkPasswordCondition(value.match(/[a-z]/), 2);
      checkPasswordCondition(value.match(/[0-9]/), 3);
      checkPasswordCondition(value.match(/[^A-Za-z0-9]/), 4);
    });

    const confirmPassword = document.querySelector('input[name="confirm_password"]');
    const iconSamePassword = document.getElementById('icon_same_password');

    confirmPassword.addEventListener('input', function () {
      const password = password.value;
      const confirmPassword = confirmPassword.value;
      console.log({
        password,
        confirmPassword
      })

      iconSamePassword.className = password === confirmPassword ? 'fa-solid fa-check good' : 'fa-solid fa-xmark bad';
    });

    confirmPassword.addEventListener('focus', function () {
      document.querySelector('.password_same').style.display = 'block';
    });

    confirmPassword.addEventListener('blur', function () {
      document.querySelector('.password_same').style.display = 'none';
    });

  </script>
{% endblock %}
